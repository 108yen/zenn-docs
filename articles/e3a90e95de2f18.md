---
title: "github actionsä¸Šã§ã‚³ãƒŸãƒƒãƒˆã™ã‚‹"
emoji: "ğŸ‘"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["githubactions", "github", "changesets"]
published: true
---

# ã¯ã˜ã‚ã«

github actionsä¸Šã§`changeset`ã‚„`lint`ã‚’èµ°ã‚‰ã›ã€ãã®å¤‰æ›´å†…å®¹ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãŸã„å ´åˆãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ä»Šå›ã¯`changeset`ã§å®Ÿæ–½ã—ã¦ã¿ãŸã®ã§ã€ãã®å†…å®¹ã‚’è¨˜éŒ²ã¨ã—ã¦æ®‹ã—ã¾ã™ã€‚

# workflowã®å®Ÿè£…

ç‰¹ã«githubã®è¨­å®šã‚’å¤‰ãˆã‚‹å¿…è¦ã¯ãªãã€workflowã®yamlä¸Šã§ç°¡æ½”ã§ãã¾ã™ã€‚ãƒã‚¤ãƒ³ãƒˆã¯`permissions`ã‚’è¨­å®šã—ã¦ã„ã‚‹ã“ã¨ã§ã€`contents: write`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã“ã®jobã«ã‚³ãƒŸãƒƒãƒˆã‚’è¨±å¯ã—ã¦ã„ã¾ã™ã€‚
:::message
`pnpm`åˆ©ç”¨ã®å‰æã§ã®è¨­å®šã«ãªã‚‹ã®ã§`npm`ã‚„`yarn`ã®å ´åˆã¯è©²å½“ç®‡æ‰€ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
:::

```yml:.github/workflows/version.yml
name: Version

on:
  push:
    branches:
      - main
      
concurrency: ${{ github.workflow }}-${{ github.ref }}

jobs:
  version:
    name: Version
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
        # pnpmã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        # npmã‚„yarnã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯å¤‰æ›´ã—ã¦ãã ã•ã„
      - name: Setup PNPM
        uses: pnpm/action-setup@v3.0.0
        with:
          version: 8  # package.jsonã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã¯ä¸è¦
        
        # nodeã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          
        # ã‚³ãƒŸãƒƒãƒˆï¼‹ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã®ã§ã€ãã®ãŸã‚ã®gitã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
        # xxx@example.comã¨userã¯è‡ªåˆ†ã®ã‚‚ã®ã«æ›¸ãæ›ãˆã¦ãã ã•ã„
      - name: Setup Git user
        shell: bash
        run: |
          git config --global user.email "xxx@example.com"
          git config --global user.name "user"
          
        # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        # npmã‚„yarnã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯å¤‰æ›´ã—ã¦ãã ã•ã„
      - name: Install dependencies
        run: pnpm install

        # å¤‰æ›´ã€ã‚³ãƒŸãƒƒãƒˆã€ãƒ—ãƒƒã‚·ãƒ¥
        # changesetã‚’å®Ÿè¡Œã—ã¦ã€ãã®å¤‰æ›´å†…å®¹ã‚’git add .ã§ã‚¹ãƒ†ãƒ¼ã‚¸ã—ã€
        # å¤‰æ›´ãŒã‚ã‚Œã°ã€ã‚³ãƒŸãƒƒãƒˆï¼‹ãƒ—ãƒƒã‚·ãƒ¥ã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™
      - name: Version Update
        run: |
          pnpm changeset version
          git add .
          git diff --staged --exit-code || (git commit -m 'ci(changelog): update version' && git push)
```

# è£œè¶³

ãƒªãƒã‚¸ãƒˆãƒªã®`Settings â†’ Actions â†’ General`ã®`Workflow permissions`ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ¨©é™è¨­å®šãŒã§ãã¾ã™ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯Readæ¨©é™ã®ã¿ã«ãªã£ã¦ãŠã‚Šã€`Read and write permissions`ã®ã»ã†ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨æ›¸ãè¾¼ã¿æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ãŸã ã—ã€ã“ã®æ–¹æ³•ã ã¨ã€`contents: write`ä»¥å¤–ã®æ›¸ãè¾¼ã¿æ¨©é™ã‚‚ä»˜ä¸ã•ã‚Œã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã®è¨­å®šã¯ä½¿ç”¨ã—ãªã„ã»ã†ãŒã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚
:::message
ãã®ã»ã‹ã®æ¨©é™ã«ã¤ã„ã¦ã‚‚ç¢ºèªã—ãŸã„å ´åˆã¯ã€ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
https://docs.github.com/ja/actions/writing-workflows/workflow-syntax-for-github-actions#permissions

:::
![workflow-permissions](/images/e3a90e95de2f18/workflow-permissions.png)

## ä»Šå›æ¤œè¨¼ã«åˆ©ç”¨ã—ãŸãƒªãƒã‚¸ãƒˆãƒª
https://github.com/108yen/changeset
